{% extends "base.html" %}
{% block content %}
<div class="container"> 
<div class="table-responsive"> 
  <div id="toolbar" class="btn-group">
   <button id="add" type="button" class="btn btn-default">
    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>新增
   </button>
   <button id="btn_edit" type="button" class="btn btn-default">
    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
   </button>
   <button id="btn_delete" type="button" class="btn btn-default">
    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
   </button>
  </div>
    <table id="tomcat_table" class="table table-bordered"></table>
</div>
</div>
<script type="text/javascript"> 
   $(function initTable() {
    $('#tomcat_table').bootstrapTable('destroy');
    $('#tomcat_table').bootstrapTable({
     method: "get",
     url: "/tomcat/tomcat_url",
     dataType: "json",
     toolbar: '#toolbar',   
     striped: true, 
     cache: false, 
     pagination: true,
     sortable: false, 
     pageNumber: 1,  
     pageSize: 10,  
     pageList: [10, 25, 50, 100], 
     search: true,  
     uniqueId: "id",
     showColumns: true, 
     showRefresh: true, 
     minimumCountColumns: 2,
     clickToSelect: true,  
     showToggle: true,   
     cardView: false,   
     detailView: false, 
     columns: [{
      checkbox: true
     },
     {
      field: 'id',
      title: 'id'
     },{
      field: 'project',
      title: 'project'
     }, {
      field: 'domain',
      title: 'domain'
     }, {
      field: 'url',
      title: 'url'
     },]
    });
   });
</script> 
<script>
$table = $("#departTable");
$remove = $('#remove');
$(document).ready(function(){
    initDepartSelect();
    //表格初始化
    var oTable = new TableInit();
    oTable.Init();
    //查询
   /* $("#queryBtn").click(function(){ $table.bootstrapTable('destroy');//表格销毁 oTable.Init() });*/
    $("#add").click(function(){
        var name = $("#nameInp").val();
        var parentId =$("#departSel").val();
            parentId = parentId=="*"?"":parentId;
        var  $remind = $(".remind");
        if($(this).find("i").hasClass("adding")){//提交新建数据
            if(project==''){
                $remind.html(' <i class="icon icon-info-sign">project不能为空!</i>');
                return;
            }
            if(/(^\s+)|(\s+$)/g.test(project)){
                $remind.html(' <i class="icon icon-info-sign">project不能输入空格!</i>');
                return;
            }
            if(name.length>20){
                $remind.html(' <i class="icon icon-info-sign">project不能超过20个字符!</i>');
                return;
            }
  $.postJSON(baseUrl+"/tomcat/add_tomcat_url",'{"project":"'+project+'","domain":"'domain'"},"url":"'url'"}',function(data){
                if(data>0){
                    $("#departSel").css("display","none");
                    $("#departSel").val("*");
                    $("#nameInp").css("display","none");
                    $("#nameInp").val("");
                    $("#cancel").css("display", "none");
                    $remind.html('');
                    $("#add").html('<i class="glyphicon glyphicon-plus"></i> 新建');
                    $table.bootstrapTable('destroy');//表格销毁
                    oTable.Init();
                    $.gritter.add({
                        title: '提示',
                        text: '新建tomcat_url成功!',
                        sticky: false,
                        time: 2500
                    });
                    initDepartSelect();
                }else{
                    alert("新建tomcat_url失败，请联系技术人员!");
                }
            })
        }else {
            $("#nameInp").css("display", "block");
            $("#departSel").css("display", "block");
            $("#cancel").css("display", "inline-block");
            $("#nameInp").focus();
            $("#add").html('<i class="glyphicon glyphicon-ok-circle adding"></i> 确认');
        }
    });
});
$("#cancel").click(function(){
    $("#departSel").css("display","none");
    $("#departSel").val("*");
    $("#nameInp").css("display","none");
    $("#nameInp").val("");
    $("#add").html('<i class="glyphicon glyphicon-plus"></i> 新建');
    $(".remind").html('');
    $(this).css("display","none");
});
</script>
{% endblock %}
